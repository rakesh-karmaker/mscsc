;/*FB_PKG_DELIM*/

__d("LSUpdateRepliesOnUnsend",["LSArrayGetObjectAt","LSDeleteMessage"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_int32(a[2].length),c.i64.gt(d[0],c.i64.cast([0,0]))?c.loopAsync(d[0],function(e){return d[1]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[1]).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(b){return d[4]=d[2].get("reply_snippet"),d[5]=d[2].get("message_id"),c.forEach(c.filter(c.db.table(12).fetch([[[d[5]]],"messageId"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===d[5]}),function(a){var b=a.update;a.item;return b({replyStatus:c.i64.cast([0,2]),replySnippet:d[4],replyMessageText:void 0,replyMediaExpirationTimestampMs:void 0,replyMediaUrl:void 0,replyMediaPreviewWidth:void 0,replyMediaPreviewHeight:void 0,replyMediaUrlMimeType:void 0,replyMediaUrlFallback:void 0,replyAttachmentId:void 0,replyAttachmentExtra:void 0})})}])}):c.resolve()},function(d){return c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"replySourceIdMessageID"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.replySourceId===a[1]&&c.i64.eq(b.replyType,c.i64.cast([0,1]))}),function(a){a=a.item;return c.storedProcedure(b("LSDeleteMessage"),a.threadKey,a.messageId)})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateRepliesOnUnsendStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);