;/*FB_PKG_DELIM*/

__d("LSDeleteRollCallContribution",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(255).fetch([[[a[0],a[1],a[2],a[3],a[4]]]]),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxDeleteRollCallContributionStoredProcedure";a.__tables__=["roll_call_contributions_v2"];e.exports=a}),null);
__d("LSHandleRepliesOnUnsend",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return d[0]=c.createArray(),c.forEach(c.filter(c.db.table(12).fetch([[[a[1]]],"replySourceIdMessageID"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.replySourceId===a[1]}),function(a){a=a.item;return d[2]=(d[0].push(a.messageId),d[0])})},function(e){return d[1]=c.i64.of_int32(d[0].length),(c.i64.eq(d[1],c.i64.cast([0,0]))?!0:!1)?c.resolve():(d[2]=new c.Map(),d[2].set("thread_key",a[0]),d[2].set("message_id",a[1]),d[2].set("reply_message_ids",d[0]),d[3]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),"update_replies_on_unsend",c.i64.cast([0,74]),d[3],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0])))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxHandleRepliesOnUnsendStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSUpdateRecentXMAForRollCallMessageDeleted",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.islc(c.sortBy(c.filter(c.db.table(255).fetch(),function(b){return c.i64.eq(b.rollCallId,a[0])&&a[1]!==b.messageId}),[["messageTimestampMs","DESC"]]),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?0:(e=a.item,c.sequence([function(a){return d[5]=e.threadKey,c.db.table(9).fetch([[[d[5]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[0]=c.i64.cast([0,1]):(e=b.item,d[7]=e.syncGroup,c.i64.neq(d[7],void 0)?d[6]=d[7]:d[6]=c.i64.cast([0,1]),d[0]=d[6])})},function(a){return d[2]=new c.Map(),d[2].set("message_id",e.messageId),d[2].set("thread_key",d[5]),d[2].set("sync_group",d[0]),d[3]=d[2].get("thread_key"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,19]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]))})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateRecentXMAForRollCallMessageDeletedStoredProcedure";a.__tables__=["roll_call_contributions_v2","threads"];e.exports=a}),null);
__d("LSUpdateRollCall",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.db.table(250).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({viewerHasContributed:a[1],isBlurred:a[2]})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateRollCallStoredProcedure";a.__tables__=["roll_calls"];e.exports=a}),null);
__d("LSUpdateForRollCallMessageDeleted",["LSDeleteRollCallContribution","LSGetViewerFBID","LSUpdateRecentXMAForRollCallMessageDeleted","LSUpdateRollCall"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.filter(c.db.table(255).fetch(),function(b){return b.messageId===a[0]}).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=[void 0,void 0,void 0],d[0]=c[0],d[1]=c[1],d[2]=c[2],c):(b=a.item,c=[b.rollCallId,b.messageTimestampMs,b.rollCallContributionId],d[0]=c[0],d[1]=c[1],d[2]=c[2],c)})},function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[4]=a[0],a})},function(b){return c.filter(c.db.table(255).fetch(),function(b){return c.i64.eq(d[0],b.rollCallId)&&a[0]!==b.messageId&&c.i64.eq(d[4],b.contributorId)}).next().then(function(a,b){b=a.done;a=a.value;return b?d[5]=!1:(a.item,d[5]=!0)})},function(a){return c.filter(c.db.table(250).fetch(),function(a){return c.i64.eq(d[0],a.rollCallId)}).next().then(function(a,b){var c=a.done;a=a.value;return c?d[7]=!1:(b=a.item,d[7]=b.canViewWithoutContributing)})},function(e){return c.i64.neq(d[0],void 0)?c.sequence([function(e){return c.storedProcedure(b("LSUpdateRecentXMAForRollCallMessageDeleted"),d[0],a[0])},function(a){return d[7]?d[9]=!1:d[9]=!d[5],c.storedProcedure(b("LSUpdateRollCall"),d[0],d[5],d[9])},function(e){return c.i64.neq(d[1],void 0)?c.i64.neq(d[2],void 0)?c.storedProcedure(b("LSDeleteRollCallContribution"),d[2],d[0],a[0],d[1],a[1]):c.resolve():c.resolve()}]):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateForRollCallMessageDeletedStoredProcedure";a.__tables__=["roll_call_contributions_v2","roll_calls"];e.exports=a}),null);
__d("LSUpdateRepliesOnSharedAlbumContributionDeletion",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.forEach(b.filter(b.db.table(12).fetch([[[a[1]]],"replySourceIdMessageID"]),function(c){return b.i64.eq(c.threadKey,a[0])&&c.replySourceId===a[1]&&b.i64.eq(c.replyAttachmentId,a[2])}),function(a){var b=a.update;a.item;return b({replySourceId:void 0,replyStatus:void 0,replyMessageText:void 0,replyMediaExpirationTimestampMs:void 0,replyMediaUrl:void 0,replyMediaPreviewWidth:void 0,replyMediaPreviewHeight:void 0,replyMediaUrlMimeType:void 0,replyMediaUrlFallback:void 0,replyAttachmentId:void 0,replyAttachmentExtra:void 0,replySourceType:void 0,replySourceTypeV2:void 0})})},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpdateRepliesOnSharedAlbumContributionDeletionStoredProcedure";a.__tables__=["messages"];e.exports=a}),null);
__d("LSUpdateSharedAlbumOnMessageRecall",["LSArrayGetObjectAt","LSIssueNewTask","LSUpdateRepliesOnSharedAlbumContributionDeletion"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),c.forEach(c.filter(c.db.table(280).fetch(),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===a[1]}),function(a){var e=a.item;return c.sequence([function(a){return d[3]=e.sharedAlbumId,d[4]=e.sharedAlbumContributionId,d[5]=e.threadKey,d[0].set(c.i64.to_string(d[3]),d[3]),c.storedProcedure(b("LSUpdateRepliesOnSharedAlbumContributionDeletion"),d[5],c.i64.to_string(d[3]),d[4])},function(a){return c.forEach(c.db.table(280).fetch([[[d[3],d[4],d[5],e.messageId]]]),function(a){return a["delete"]()})}])})},function(e){return d[1]=d[0].keys(),d[2]=c.i64.of_int32(d[1].length),c.i64.gt(d[2],c.i64.cast([0,0]))?c.loopAsync(d[2],function(e){return d[3]=e,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[1],d[3]).then(function(a){return a=a,d[4]=a[0],d[5]=a[1],a})},function(e){return d[6]=d[0].get(d[4]),c.forEach(c.filter(c.db.table(16).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(b.collapsibleId,d[6])}),function(e){var f=e.item;return c.sequence([function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[7]=c.i64.cast([0,1]):(b=a.item,d[13]=b.syncGroup,c.i64.neq(d[13],void 0)?d[12]=d[13]:d[12]=c.i64.cast([0,1]),d[7]=d[12])})},function(e){return d[9]=new c.Map(),d[9].set("message_id",f.messageId),d[9].set("thread_key",a[0]),d[9].set("sync_group",d[7]),d[10]=d[9].get("thread_key"),d[11]=c.toJSON(d[9]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[10]),c.i64.cast([0,19]),d[11],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])})}])}):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateSharedAlbumOnMessageRecallStoredProcedure";a.__tables__=["shared_album_contributions","attachments","threads"];e.exports=a}),null);
__d("LSUpdateUnsentMessageCollapsedStatus",["LSCollapseAttachments"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.filter(c.db.table(16).fetch([[[a[0],a[2],a[1]]],"fk_messages"]),function(b){return c.i64.eq(b.threadKey,a[0])&&b.messageId===a[1]&&c.i64.eq(b.timestampMs,a[2])&&c.i64.neq(b.collapsibleId,void 0)}).next().then(function(e,f){var g=e.done;e=e.value;return g?0:(f=e.item,c.sequence([function(b){return d[0]=f.collapsibleId,c.forEach(c.db.table(16).fetch([[[a[0],a[2],a[1]]],"fk_messages"]),function(a){var b=a.update;a.item;return b({collapsibleId:void 0})})},function(e){return c.i64.neq(d[0],void 0)?c.storedProcedure(b("LSCollapseAttachments"),a[0],d[0]):c.resolve()}]))})},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxUpdateUnsentMessageCollapsedStatusStoredProcedure";a.__tables__=["attachments"];e.exports=a}),null);
__d("LSVerifyAndUpsertThreadQueueSequenceID",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(b){return c.db.table(294).fetch([[[a[0]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,0]):(b=a.item,d[0]=b.threadQueueSequenceId)})},function(e){return c.i64.lt(c.i64.add(d[0],c.i64.cast([0,1])),a[1])?(d[2]=new c.Map(),d[2].set("thread_id",a[0]),d[2].set("previous_tq_seq_id",d[0]),d[2].set("current_tq_seq_id",a[1]),d[2].set("delta_type",a[2]),d[3]=d[2].get("thread_id"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),["cm_thread_hole_detection",c.i64.to_string(d[3])].join(""),c.i64.cast([0,501]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))):c.resolve()},function(b){return c.i64.gt(a[1],d[0])?c.db.table(294).fetch([[[a[0]]]]).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(294).add({threadKey:a[0],threadQueueSequenceId:a[1]}):(b.item,c.forEach(c.db.table(294).fetch([[[a[0]]]]),function(b){var c=b.update;b.item;return c({threadQueueSequenceId:a[1]})}))}):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSMailboxVerifyAndUpsertThreadQueueSequenceIDStoredProcedure";a.__tables__=["community_thread_sync_info"];e.exports=a}),null);